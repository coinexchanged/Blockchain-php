/**
 @Name：winui.helper 桌面助手模块
 @Author：Leo
 @License：MIT
    
 */
layui.define(["jquery","layer","winui"],function(n){"use strict";var t=layui.jquery,h=".winui-helper-lock",c=".winui-helper-menu",e=".winui-helper-switch",i=".winui-helper-content",f=".winui-helper-tool",l=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,y=function(n){var i=n.toLowerCase(),r,u,t;if(i&&l.test(i)){if(i.length===4){for(r="#",t=1;t<4;t+=1)r+=i.slice(t,t+1).concat(i.slice(t,t+1));i=r}for(u=[],t=1;t<7;t+=2)u.push(parseInt("0x"+i.slice(t,t+2)));return"RGB("+u.join(",")+")"}return i},o=function(n,t){var i=parseInt("0x"+n.substr(1,2)),r=parseInt("0x"+n.substr(3,2)),u=parseInt("0x"+n.substr(5,2)),f=t;return"rgba("+i+","+r+","+u+","+f+")"},p=function(n,t,i){return'<span class="tool-tags" data-tips="'+n+'"><i '+(i?'style = "'+i+'"':"")+' class="fa fa-fw '+t+'"><\/i><\/span>'},a='<div class="winui-helper-content"><hr/><div class="winui-helper-tool"><\/div><\/div>',v=function(n,t){return'<span class="winui-helper-setwin"><a title="解锁" class="winui-helper-lock"><i class="fa fa-fw '+(n?"fa-lock":"fa-unlock-alt")+'"><\/i><\/a><a title="菜单" class="winui-helper-menu"><i class="fa fa-fw fa-bars"><\/i><\/a><a title="收起" class="winui-helper-switch"><i class="fa fa-fw '+(t?"fa-chevron-up":"fa-chevron-down")+'"><\/i><\/a><\/span>'},s=function(){t(".winui-desktop-item").toggle()},r=function(n){var i=this;i.cache=i.config;i.config=layui.data("winui-helper").configs||i.config;i.config=t.extend({},i.config,n);i.render()},u;r.prototype.config={bgColor:"#010101",opacity:.3,dblclickHide:!1};r.prototype.render=function(n,r){var u,f;n=n||layui.data("winui-helper").options||{move:!0,lock:!1,up:!1};n.move===!0&&(n.move=".layui-layer-title");u=this;layui.link(winui.path+"css/helper.css","helper");f={id:"helper",type:1,title:"桌面助手",skin:"layer-ext-winhelper",shade:0,closeBtn:0,anim:-1,content:a,zIndex:layer.zIndex,offset:n.offset||["12vh","72vw"],success:function(f){t(f).css({"background-color":o(u.config.bgColor,u.config.opacity)});t(f).append(v(n.lock,n.up));n.up?t(i).show():t(i).hide();u.addTool([{tips:"添加便签",icon:"fa-pencil-square-o",click:function(){var n=t(i).children(".tags-content").length,r;if(n>=5){layer.msg("最多只能存五条便签",{zIndex:layer.zIndex});return}t(i).append('<hr /><div class="tags-content"><textarea placeholder="输入内容，如：桌面助手真牛逼"><\/textarea><\/div>');r=t(i).children(".tags-content").eq(n).children("textarea");r.focus();r.on("blur",function(){var r=t(this).val(),i;if(t.trim(r)===""){t(this).parent().prev("hr").remove();t(this).parent().remove();i=layui.data("winui-helper").tags||[];i.splice(n,1);layui.data("winui-helper",{key:"tags",value:i});return}i=layui.data("winui-helper").tags||[];i.push(r);layui.data("winui-helper",{key:"tags",value:i})})}},{tips:"主题设置",icon:"fa-paw",click:function(){winui.window.openTheme()}}]);var s=layui.data("winui-helper").tags;s instanceof Array&&t.each(s,function(n,r){if(!(n>=5)){t(i).append('<hr /><div class="tags-content"><textarea placeholder="输入内容，便签存于本地">'+r+"<\/textarea><\/div>");t(i).children(".tags-content").eq(n).children("textarea").on("blur",function(){var r=t(this).val(),i=layui.data("winui-helper").tags||[];if(t.trim(r)===""){t(this).parent().prev("hr").remove();t(this).parent().remove();i.splice(n,1);layui.data("winui-helper",{key:"tags",value:i});return}i[n]=r;layui.data("winui-helper",{key:"tags",value:i})})}});t(h).on("click",function(){var r=t(f).css("top"),e=t(f).css("left"),i={offset:[r,e],up:n.up};n.move?(t(f).remove(),t.extend(i,{move:!1,lock:!0})):(t(f).remove(),t.extend(i,{move:!0,lock:!1}));u.render(i,function(){var n=layui.data("winui-helper").extTool;n&&u.addTool(n)})});t(c).on("click",function(n){layui.stope(n);var i=n.clientX,r=n.clientY,f='<ul class="helper-menu" style="top:'+r+"px;left:"+i+'px;"><li><i class="fa fa-fw fa-cog"><\/i>设置<\/li><li><i class="fa fa-fw fa-outdent"><\/i>退出桌面助手<\/li><\/ul>';t(".helper-menu").remove();t("body").append(f);t(".helper-menu li").eq(0).on("mousedown",function(n){layui.stope(n);n.button==0&&t.get(winui.path+"html/helper/settings.html",{},function(n){layer.open({id:"helpersettings",title:"桌面助手设置中心",type:1,area:["560px","400px"],skin:"layer-ext-hprsettings",content:n,shade:0,zIndex:layer.zIndex,success:function(n){layer.setTop(n);var i=t(n).find(".layui-layer-title");i.css("cursor","default");i.on("mousedown",function(){t(".layui-layer-move").css("cursor","default")});t(n).find(".layui-layer-close").removeAttr("href")}})})});t(".helper-menu li").eq(1).on("mousedown",function(n){layui.stope(n);n.button==0&&u.destroy()})});t(e).on("click",function(){t(i).slideToggle("fast");t(e).find(".fa").toggleClass("fa-chevron-up").toggleClass("fa-chevron-down");n.up=!n.up;layui.data("winui-helper",{key:"options",value:n})});typeof r=="function"&&r.call(f)}};layui.data("winui-helper",{key:"options",value:n});t.extend(f,n);u.index=layer.open(f)};r.prototype.addTool=function(n){var i,r;if(n){!n instanceof Array&&(n=[n]);i=t(f).children("span").length;t.each(n,function(n,r){if(t(f).append('<span data-tips="'+r.tips+'"><i '+(r.style?'style = "'+r.style+'"':"")+' class="fa fa-fw '+r.icon+'"><\/i><\/span>'),typeof r.click=="function")t(f).children("span").eq(i+n).on("click",r.click)});t(".winui-helper-tool>span").off("mouseover").off("mouseout").on("mouseover",function(){r=layer.tips(t(this).data("tips"),this,{zIndex:layer.zIndex,tips:[3,"#f5f5f5"],skin:"winui-helper-tips",time:0,anim:5,success:function(n){var i=Number(t(n).css("top").replace("px",""))+5+"px",r=Number(t(n).css("left").replace("px",""))-10+"px";t(n).css({top:i,left:r})}})}).on("mouseout",function(){layer.close(r)})}};r.prototype.destroy=function(){t(".layer-ext-winhelper,.helper-menu").remove()};r.prototype.bgset=function(n){var t=this,i;if(t.index){n=n||{};for(i in n)t.config[i]=n[i];layer.style(t.index,{"background-color":o(t.config.bgColor,t.config.opacity)});layui.data("winui-helper",{key:"configs",value:t.config})}};r.prototype.dblHideSet=function(n){var i=this;if(n!==undefined&&(i.config.dblclickHide=n,layui.data("winui-helper",{key:"configs",value:i.config})),i.config.dblclickHide===!0)t(".winui-desktop").on("dblclick",s);else t(".winui-desktop").off("dblclick",s),t(".winui-desktop-item").show()};u={};u.creat=function(n){var i=this,t=new r(n),u=function(){i.bgColor=t.config.bgColor;i.opacity=t.config.opacity;i.dblhide=t.config.dblclickHide};this.bgset=function(n){t.bgset(n);u()};this.bgReset=function(){i.bgset({bgColor:t.cache.bgColor,opacity:t.cache.opacity})};this.toggleHide=function(n){t.dblHideSet(n);u()};this.addTool=function(n){layui.data("winui-helper",{key:"extTool",value:n});t.addTool(n)};t.dblHideSet();u()};u.creat();winui.helper=u;n("helper",{});t(document).on("mousedown click",function(){t(".helper-menu").remove()});t(window).resize(function(){t(".helper-menu").remove()});delete layui.helper});