/**
 @Name：winui.dektop 桌面模块
 @Author：Leo
 @License：MIT
    
 */
layui.define(["jquery","layer","winui"],function(n){"use strict";var t=layui.jquery,u=function(n){this.options=n||{url:winui.path+"json/desktopmenu.json",method:"get"};this.data=null},i;u.prototype.render=function(n){if(this.data!==null){var i="";t(this.data).each(function(n,t){var u=t.id==""||t.id==undefined?"":'win-id="'+t.id+'"',f=t.pageURL==""||t.pageURL==undefined?"":'win-url="'+t.pageURL+'"',e=t.title==""||t.title==undefined?"":'win-title="'+t.title+'"',o=t.openType==""||t.openType==undefined?"":'win-opentype="'+t.openType+'"',s=t.maxOpen==""||t.maxOpen==undefined?"":'win-maxOpen="'+t.maxOpen+'"',r=t.icon.indexOf("fa-")!=-1&&t.icon.indexOf(".")==-1,h=r?'<i class="fa '+t.icon+' fa-fw"><\/i>':'<img src="'+t.icon+'" />';i+='<div class="winui-desktop-item" '+u+" "+f+" "+e+" "+o+" "+s+">";i+='<div class="winui-icon '+(r?"winui-icon-font":"winui-icon-img")+'">';i+=h;i+="<\/div>";i+="<p>"+t.name+"<\/p>";i+="<\/div>"});t(".winui-desktop").html(i);r.locaApp();typeof n=="function"&&n.call(this,e)}};u.prototype.setData=function(n){var i=this,r=i.options;r.url&&r.method&&t.ajax({url:r.url,type:r.method,data:t.extend({},r.data),dataType:"json",success:function(t){t=t.data;typeof t=="string"?(i.data=JSON.parse(t),typeof n=="function"&&n.call(i)):typeof t=="object"&&(Object.prototype.toString.call(t).toLowerCase()=="[object object]"||Object.prototype.toString.call(t).toLowerCase()=="[object array]")?(i.data=t,typeof n=="function"&&n.call(i)):layer.msg("请对接口返回json对象或者json字符串",{offset:"40px",zIndex:layer.zIndex})},error:function(n){n.status!=200?console.error(n.statusText):layer.msg("请对接口返回json对象或者json字符串",{offset:"40px",zIndex:layer.zIndex})}})};i=function(){this.contextmenuOptions={}};i.prototype.contextmenu=function(n){n.item&&(r.resetEvent(".winui-desktop>.winui-desktop-item","mouseup",function(i){var u;if(i||(i=window.event),u=this,i.button==2){var e=i.clientX,s=i.clientY,f='<ul class="app-contextmenu" style="top:'+s+"px;left:"+e+'px;">';t(n.item).each(function(n,t){f+="<li>"+t+"<\/li>"});f+="<\/ul>";t(".app-contextmenu").remove();t("body").append(f);t("ul.app-contextmenu li").on("click",function(){var i=t(this).index();typeof n["item"+(i+1)]=="function"&&(n["item"+(i+1)].call(this,t(u).attr("win-id"),t(u),{reLocaApp:r.locaApp}),t(".app-contextmenu").remove(),t(".winui-desktop>.winui-desktop-item").removeClass("winui-this"))});t(".app-contextmenu li").on("click mousedown",o.sp)}t(u).addClass("winui-this").siblings().removeClass("winui-this")}),this.contextmenuOptions=n)};i.prototype.onclick=function(n){typeof n=="function"&&r.resetEvent(".winui-desktop-item","click",function(i){i.stopPropagation();n.call(this,t(this).attr("win-id"),this);t(".winui-desktop>.winui-desktop-item").removeClass("winui-this")})};i.prototype.ondblclick=function(n){typeof n=="function"&&r.resetEvent(".winui-desktop-item","dblclick",function(i){i.stopPropagation();n.call(this,t(this).attr("win-id"),this);t(".winui-desktop>.winui-desktop-item").removeClass("winui-this")})};var e=new i,r={resetEvent:function(n,i,r){if(typeof r=="function")t(n).off(i).on(i,r)},locaApp:function(){var f=96,e=90,r=parseInt(t(".winui-desktop").height()/93),i=0,n=0,u=0;t(".winui-desktop>.winui-desktop-item").each(function(o){var s=parseInt(o/r);u=parseInt(o/r);n=i==s?n:0;n==0&&i!=s&&i++;t(this).css("top",f*n+"px").css("left",e*u+"px");n++})}},o={sp:function(n){layui.stope(n)}},f=new u;f.config=function(n){n=n||{};for(var t in n)this.options[t]=n[t];return this};f.init=function(n,t){typeof n=="object"?this.config(n):typeof n=="fuction"&&(t=n);this.done=t=t||this.done;this.setData(function(){this.render(t)})};winui.desktop=f;n("desktop",{});delete layui.desktop});